@model WebsiteHotrohoctap.Models.LessonContent

@{
    ViewData["Title"] = "Cập nhật Nội Dung Bài Học";
}

<h1>Cập nhật Nội Dung Bài Học</h1>
<hr />

<div class="row">
    <div class="col-md-6">
        <form asp-action="Update" enctype="multipart/form-data" method="post">
            <div asp-validation-summary="ModelOnly" class="text-danger"></div>
            <input type="hidden" asp-for="ContentID" />

            <div class="form-group mb-3">
                <label asp-for="ContentType">Loại nội dung</label>
                <select asp-for="ContentType" class="form-control" id="contentTypeSelect">
                    <option value="">-- Chọn loại nội dung --</option>
                    <option value="text" selected="@(Model.ContentType == "text")">Văn bản</option>
                    <option value="image" selected="@(Model.ContentType == "image")">Hình ảnh</option>
                    <option value="video" selected="@(Model.ContentType == "video")">Video</option>
                </select>
            </div>

            <!-- Văn bản -->
            <div class="form-group mb-3" id="textInput" style="display:none;">
                <label>Nội dung văn bản</label>
                <textarea asp-for="ContentData" name="TextContent" class="form-control" rows="5"></textarea>
            </div>

            <!-- Ảnh -->
            <div class="form-group mb-3" id="imageInput" style="display:none;">
                <label>Chọn ảnh mới (hoặc giữ nguyên ảnh cũ)</label>
                <input type="file" name="ImageFile" class="form-control" accept="image/*" />
                @if (!string.IsNullOrEmpty(Model.ContentData))
                {
                    <div class="mt-2">
                        <p>Ảnh hiện tại:</p>
                        <img src="@Model.ContentData" width="200" class="img-thumbnail" />
                    </div>
                }
            </div>

            <!-- Video -->
            <div class="form-group mb-3" id="videoInput" style="display:none;">
                <label>Link video</label>
                <input type="text" name="VideoUrl" class="form-control" value="@Model.ContentData" placeholder="https://youtube.com/..." />
            </div>

            <div class="form-group mb-3">
                <label asp-for="LessonID">Chọn bài học</label>
                <select asp-for="LessonID" class="form-control" asp-items="ViewBag.Lessons"></select>
            </div>

            <div class="form-group">
                <input type="submit" value="Cập nhật" class="btn btn-success" />
            </div>
        </form>
    </div>
</div>

<div>
    <a asp-action="Index" class="btn btn-secondary mt-3">← Quay lại danh sách</a>
</div>

@section Scripts {
    <script>
        function toggleInputs() {
            const type = document.getElementById('contentTypeSelect').value;
            document.getElementById('textInput').style.display = (type === 'text') ? 'block' : 'none';
            document.getElementById('imageInput').style.display = (type === 'image') ? 'block' : 'none';
            document.getElementById('videoInput').style.display = (type === 'video') ? 'block' : 'none';
        }

        document.getElementById('contentTypeSelect').addEventListener('change', toggleInputs);
        window.onload = toggleInputs;
    </script>
    @await Html.PartialAsync("_ValidationScriptsPartial")
}
@if (!ViewData.ModelState.IsValid)
{
    <div class="alert alert-danger mt-3">
        <ul>
            @foreach (var error in ViewData.ModelState.Values.SelectMany(v => v.Errors))
            {
                <li>@error.ErrorMessage</li>
            }
        </ul>
    </div>
}